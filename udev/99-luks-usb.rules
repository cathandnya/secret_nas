# udev rule for LUKS encrypted USB device
# Triggers services when the registered USB device is connected/disconnected
#
# This file will be customized during setup with the actual LUKS UUID
# The placeholder __LUKS_UUID__ will be replaced with the real UUID

# When the LUKS device appears, start the unlock service
ACTION=="add", ENV{ID_FS_UUID}=="__LUKS_UUID__", ENV{ID_FS_TYPE}=="crypto_LUKS", TAG+="systemd", ENV{SYSTEMD_WANTS}="luks-open-nas.service"

# When the LUKS device is removed, trigger cleanup service
ACTION=="remove", ENV{ID_FS_UUID}=="__LUKS_UUID__", ENV{ID_FS_TYPE}=="crypto_LUKS", TAG+="systemd", ENV{SYSTEMD_WANTS}="luks-close-nas.service"
