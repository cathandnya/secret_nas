# Secret NAS ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

**Language**: æ—¥æœ¬èª | [English](STRUCTURE_EN.md)

## ğŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“æ§‹é€ 

```
secret_nas/
â”œâ”€â”€ ğŸ“„ README.md                    # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”œâ”€â”€ ğŸ“„ STRUCTURE.md                 # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ èª¬æ˜ï¼‰
â”‚
â”œâ”€â”€ ğŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤ç”¨ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆRaspberry Piã«é…ç½®ï¼‰
â”‚   â”œâ”€â”€ setup.sh                    # ãƒ¡ã‚¤ãƒ³ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â”œâ”€â”€ src/                        # Pythonã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰
â”‚   â”‚   â”œâ”€â”€ monitor.py              # ç›£è¦–ãƒ‡ãƒ¼ãƒ¢ãƒ³
â”‚   â”‚   â”œâ”€â”€ access_tracker.py       # ã‚¢ã‚¯ã‚»ã‚¹è¨˜éŒ²ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ secure_wipe.py          # ã‚»ã‚­ãƒ¥ã‚¢æ¶ˆå»
â”‚   â”‚   â”œâ”€â”€ notifier.py             # ãƒ¡ãƒ¼ãƒ«é€šçŸ¥
â”‚   â”‚   â”œâ”€â”€ config_loader.py        # è¨­å®šç®¡ç†
â”‚   â”‚   â””â”€â”€ logger.py               # ãƒ­ã‚®ãƒ³ã‚°
â”‚   â”œâ”€â”€ config/                     # è¨­å®šãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
â”‚   â”‚   â””â”€â”€ smb.conf.template       # Sambaè¨­å®š
â”‚   â”œâ”€â”€ systemd/                    # systemdãƒ¦ãƒ‹ãƒƒãƒˆ
â”‚   â”‚   â”œâ”€â”€ nas-monitor.service     # ç›£è¦–ã‚µãƒ¼ãƒ“ã‚¹å®šç¾©
â”‚   â”‚   â””â”€â”€ smbd-wait-mount.service # Sambaãƒã‚¦ãƒ³ãƒˆå¾…æ©Ÿã‚µãƒ¼ãƒ“ã‚¹
â”‚   â””â”€â”€ scripts/                    # Raspberry Piç”¨ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚       â”œâ”€â”€ quick-test.sh           # ã‚¯ã‚¤ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ
â”‚       â””â”€â”€ test-all.sh             # çµ±åˆãƒ†ã‚¹ãƒˆ
â”‚
â”œâ”€â”€ ğŸ› ï¸ é–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆç”¨ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã®ã¿ï¼‰
â”‚   â”œâ”€â”€ deploy.sh                   # ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ä½œæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â”œâ”€â”€ Dockerfile                  # Dockerãƒ†ã‚¹ãƒˆç’°å¢ƒ
â”‚   â”œâ”€â”€ docker-compose.yml          # Docker Composeè¨­å®š
â”‚   â”œâ”€â”€ .dockerignore               # Docker buildã‹ã‚‰é™¤å¤–
â”‚   â”œâ”€â”€ .gitignore                  # Gitç®¡ç†ã‹ã‚‰é™¤å¤–
â”‚   â””â”€â”€ scripts/                    # é–‹ç™ºç”¨ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚       â”œâ”€â”€ test-docker.sh          # Dockerãƒ†ã‚¹ãƒˆèµ·å‹•
â”‚       â”œâ”€â”€ test-local.sh           # ãƒ«ãƒ¼ãƒ—ãƒãƒƒã‚¯ãƒ‡ãƒã‚¤ã‚¹ãƒ†ã‚¹ãƒˆ
â”‚       â””â”€â”€ test-modules.sh         # Pythonãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å˜ä½“ãƒ†ã‚¹ãƒˆ
â”‚
â””â”€â”€ ğŸ“¦ ç”Ÿæˆã•ã‚Œã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆ.gitignoreã§é™¤å¤–ï¼‰
    â”œâ”€â”€ deploy/                     # ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ä¸€æ™‚ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
    â”œâ”€â”€ test-storage/               # Dockerç”¨ãƒ†ã‚¹ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸
    â”œâ”€â”€ test-local/                 # ãƒ­ãƒ¼ã‚«ãƒ«ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿
    â””â”€â”€ *.tar.gz                    # ãƒ‡ãƒ—ãƒ­ã‚¤ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–
```

---

## ğŸš€ Raspberry Piã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«

ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ãŒRaspberry Piã§å¿…è¦ã§ã™ï¼š

### å¿…é ˆãƒ•ã‚¡ã‚¤ãƒ«
```
setup.sh                            # ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
README.md                           # ä½¿ç”¨æ–¹æ³•
src/monitor.py                      # ç›£è¦–ãƒ‡ãƒ¼ãƒ¢ãƒ³
src/access_tracker.py               # ã‚¢ã‚¯ã‚»ã‚¹è¿½è·¡
src/secure_wipe.py                  # ã‚»ã‚­ãƒ¥ã‚¢æ¶ˆå»
src/notifier.py                     # é€šçŸ¥
src/config_loader.py                # è¨­å®šèª­ã¿è¾¼ã¿
src/logger.py                       # ãƒ­ã‚®ãƒ³ã‚°
config/smb.conf.template            # Sambaè¨­å®šãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
systemd/nas-monitor.service         # systemdã‚µãƒ¼ãƒ“ã‚¹
systemd/smbd-wait-mount.service     # Sambaãƒã‚¦ãƒ³ãƒˆå¾…æ©Ÿã‚µãƒ¼ãƒ“ã‚¹
scripts/quick-test.sh               # ã‚¯ã‚¤ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ
scripts/test-all.sh                 # çµ±åˆãƒ†ã‚¹ãƒˆ
```

### ãƒ‡ãƒ—ãƒ­ã‚¤ã‚µã‚¤ã‚º
- **åœ§ç¸®å¾Œ**: ç´„15-20KB
- **å±•é–‹å¾Œ**: ç´„50-60KB

---

## ğŸ› ï¸ é–‹ç™ºç’°å¢ƒã§ã®ã¿ä½¿ç”¨ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«

ä»¥ä¸‹ã¯Raspberry Piã«ã¯ä¸è¦ã§ã™ï¼š

### ãƒ†ã‚¹ãƒˆãƒ»é–‹ç™ºãƒ„ãƒ¼ãƒ«
```
deploy.sh                           # ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ä½œæˆ
Dockerfile                          # Dockerãƒ†ã‚¹ãƒˆç’°å¢ƒ
docker-compose.yml                  # Docker Composeè¨­å®š
.dockerignore                       # Dockeré™¤å¤–è¨­å®š
.gitignore                          # Gité™¤å¤–è¨­å®š
scripts/test-docker.sh              # Dockerãƒ†ã‚¹ãƒˆ
scripts/test-local.sh               # ãƒ«ãƒ¼ãƒ—ãƒãƒƒã‚¯ãƒ‡ãƒã‚¤ã‚¹ãƒ†ã‚¹ãƒˆ
scripts/test-modules.sh             # ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å˜ä½“ãƒ†ã‚¹ãƒˆ
```

---

## ğŸ“¦ ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹æ³•

### æ–¹æ³•1: deploy.shã‚’ä½¿ã†ï¼ˆæ¨å¥¨ï¼‰

```bash
# é–‹ç™ºãƒã‚·ãƒ³ã§
./deploy.sh

# Raspberry Piã«è»¢é€
scp secret_nas_deploy.tar.gz pi@pi.local:~/

# Raspberry Piã§
ssh pi@pi.local
mkdir -p ~/secret_nas
tar -xzf secret_nas_deploy.tar.gz -C ~/secret_nas
cd ~/secret_nas
sudo ./setup.sh
```

### æ–¹æ³•2: ç›´æ¥è»¢é€

```bash
# é–‹ç™ºãƒã‚·ãƒ³ã§ï¼ˆå¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ï¼‰
scp -r setup.sh src config systemd scripts README.md pi@pi.local:~/secret_nas/

# Raspberry Piã§
ssh pi@pi.local
cd ~/secret_nas
sudo ./setup.sh
```

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆç’°å¢ƒ

### ãƒ­ãƒ¼ã‚«ãƒ«ï¼ˆé–‹ç™ºãƒã‚·ãƒ³ï¼‰ã§ãƒ†ã‚¹ãƒˆ

```bash
# Pythonãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆï¼ˆæœ€é€Ÿï¼‰
./scripts/test-modules.sh

# Dockerã§å®Œå…¨ãƒ†ã‚¹ãƒˆ
./scripts/test-docker.sh

# ãƒ«ãƒ¼ãƒ—ãƒãƒƒã‚¯ãƒ‡ãƒã‚¤ã‚¹ãƒ†ã‚¹ãƒˆï¼ˆLinux/Macï¼‰
sudo ./scripts/test-local.sh
```

### Raspberry Piã§ãƒ†ã‚¹ãƒˆ

```bash
# ã‚¯ã‚¤ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ
sudo ./scripts/quick-test.sh

# çµ±åˆãƒ†ã‚¹ãƒˆ
sudo ./scripts/test-all.sh
```

---

## ğŸ—‚ï¸ Raspberry Piä¸Šã§ç”Ÿæˆã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«

ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å¾Œã€ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒRaspberry Piä¸Šã«ä½œæˆã•ã‚Œã¾ã™ï¼š

```
/opt/nas-monitor/                   # ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
â”œâ”€â”€ src/                            # Pythonãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”‚   â”œâ”€â”€ monitor.py
â”‚   â”œâ”€â”€ access_tracker.py
â”‚   â”œâ”€â”€ secure_wipe.py
â”‚   â”œâ”€â”€ notifier.py
â”‚   â”œâ”€â”€ config_loader.py
â”‚   â””â”€â”€ logger.py

/etc/nas-monitor/                   # è¨­å®šãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
â””â”€â”€ config.json                     # å®Ÿè¡Œæ™‚è¨­å®š

/var/lib/nas-monitor/               # çŠ¶æ…‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
â”œâ”€â”€ last_access.json                # ã‚¢ã‚¯ã‚»ã‚¹å±¥æ­´
â””â”€â”€ notification_state.json         # é€šçŸ¥çŠ¶æ…‹

/etc/systemd/system/                # systemdã‚µãƒ¼ãƒ“ã‚¹
â””â”€â”€ nas-monitor.service

/etc/samba/                         # Sambaè¨­å®š
â””â”€â”€ smb.conf                        # Sambaè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

/var/log/samba/                     # ãƒ­ã‚°ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
â””â”€â”€ audit.log                       # ç›£æŸ»ãƒ­ã‚°

/root/.nas-keyfile                  # LUKSæš—å·åŒ–ã‚­ãƒ¼ï¼ˆé‡è¦ï¼ï¼‰

/mnt/secure_nas/                    # ãƒã‚¦ãƒ³ãƒˆãƒã‚¤ãƒ³ãƒˆ
â””â”€â”€ (æš—å·åŒ–ã•ã‚ŒãŸUSBã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸)
```

---

## ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®æ³¨æ„

### ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ¨å¥¨
- `/root/.nas-keyfile` - æš—å·åŒ–ã‚­ãƒ¼ï¼ˆç´›å¤±ã™ã‚‹ã¨å¾©æ—§ä¸å¯èƒ½ï¼‰

### ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä¸è¦
- `/var/lib/nas-monitor/` - çŠ¶æ…‹ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆå†ç”Ÿæˆå¯èƒ½ï¼‰
- `/var/log/samba/` - ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«

---

## ğŸ“Š ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºæ¦‚ç®—

| ã‚«ãƒ†ã‚´ãƒª | ãƒ•ã‚¡ã‚¤ãƒ«æ•° | ã‚µã‚¤ã‚º |
|---------|-----------|--------|
| ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆåœ§ç¸®ï¼‰ | 1 | 15-20KB |
| ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆå±•é–‹ï¼‰ | 13 | 50-60KB |
| ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œ | - | ç´„100KB |
| è¨­å®šãƒ»çŠ¶æ…‹ãƒ•ã‚¡ã‚¤ãƒ« | - | 1-5KB |
| ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆæ—¥æ¬¡ï¼‰ | - | 10-50KB |

**åˆè¨ˆ**: Raspberry Piä¸Šã§ç´„200KBä»¥ä¸‹
